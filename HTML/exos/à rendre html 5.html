<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Statistiques des Communes et Régions de France</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .container {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        select, #communeStats {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box; /* Important pour le padding */
        }
        #communeStats {
            min-height: 100px; /* Pour un affichage correct */
            overflow-y: auto; /* Ajoute une barre de défilement si le contenu dépasse */
        }
        .stat-item {
            margin-bottom: 8px;
        }
        .error-message {
            color: red;
            font-weight: bold;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>Statistiques des Communes et Régions de France</h1>
    <div class="container">
        <label for="regionSelect">Sélectionnez une région :</label>
        <select id="regionSelect">
            <option value="">Choisissez une région</option>
        </select>

        <label for="departementSelect">Sélectionnez un département :</label>
        <select id="departementSelect">
            <option value="">Choisissez un département</option>
        </select>

        <label for="communeSelect">Sélectionnez une commune :</label>
        <select id="communeSelect">
            <option value="">Choisissez une commune</option>
        </select>

        <div id="communeStats">
            <!-- Les statistiques de la commune seront affichées ici -->
        </div>
        <div id="errorMessage" class="error-message"></div>
    </div>

    <script>
        const regionSelect = document.getElementById('regionSelect');
        const departementSelect = document.getElementById('departementSelect');
        const communeSelect = document.getElementById('communeSelect');
        const communeStatsDiv = document.getElementById('communeStats');
        const errorMessageDiv = document.getElementById('errorMessage');

        // Fonction pour afficher un message d'erreur
        function afficherErreur(message) {
            errorMessageDiv.textContent = message;
        }

        // Fonction pour effacer le message d'erreur
        function effacerErreur() {
            errorMessageDiv.textContent = '';
        }

        // Fonction pour vider les sélections de départements et communes
        function viderDepartementsEtCommunes() {
            departementSelect.innerHTML = '<option value="">Choisissez un département</option>';
            communeSelect.innerHTML = '<option value="">Choisissez une commune</option>';
            communeStatsDiv.innerHTML = '';
        }

        // Fonction pour vider la sélection des communes
        function viderCommunes() {
            communeSelect.innerHTML = '<option value="">Choisissez une commune</option>';
            communeStatsDiv.innerHTML = '';
        }

        // Fonction pour récupérer les régions
        async function chargerRegions() {
            try {
                const response = await fetch('https://geo.api.gouv.fr/regions');
                if (!response.ok) {
                    throw new Error(`Erreur HTTP: ${response.status}`);
                }
                const regions = await response.json();

                regions.forEach(region => {
                    const option = document.createElement('option');
                    option.value = region.code;
                    option.textContent = region.nom;
                    regionSelect.appendChild(option);
                });
            } catch (error) {
                afficherErreur(`Erreur lors du chargement des régions: ${error.message}`);
            }
        }

        // Fonction pour récupérer les départements d'une région
        async function chargerDepartements(codeRegion) {
            viderDepartementsEtCommunes(); // Vider les sélections précédentes
            if (!codeRegion) {
                return;
            }

            try {
                const response = await fetch(`https://geo.api.gouv.fr/departements?regions=${codeRegion}`);
                if (!response.ok) {
                    throw new Error(`Erreur HTTP: ${response.status}`);
                }
                const departements = await response.json();

                departements.forEach(departement => {
                    const option = document.createElement('option');
                    option.value = departement.code;
                    option.textContent = departement.nom;
                    departementSelect.appendChild(option);
                });
            } catch (error) {
                afficherErreur(`Erreur lors du chargement des départements: ${error.message}`);
            }
        }

        // Fonction pour récupérer les communes d'un département
        async function chargerCommunes(codeDepartement) {
            viderCommunes(); // Vider la sélection précédente
            if (!codeDepartement) {
                return;
            }

            try {
                const response = await fetch(`https://geo.api.gouv.fr/communes?departement=${codeDepartement}`);
                if (!response.ok) {
                    throw new Error(`Erreur HTTP: ${response.status}`);
                }
                const communes = await response.json();

                communes.forEach(commune => {
                    const option = document.createElement('option');
                    option.value = commune.code;
                    option.textContent = commune.nom;
                    communeSelect.appendChild(option);
                });
            } catch (error) {
                afficherErreur(`Erreur lors du chargement des communes: ${error.message}`);
            }
        }

        // Fonction pour afficher les statistiques d'une commune
        async function afficherStatistiquesCommune(codeCommune) {
            if (!codeCommune) {
                communeStatsDiv.innerHTML = ''; // Effacer si aucune commune n'est sélectionnée
                return;
            }

            try {
                const response = await fetch(`https://geo.api.gouv.fr/communes/${codeCommune}`);
                if (!response.ok) {
                    throw new Error(`Erreur HTTP: ${response.status}`);
                }
                const commune = await response.json();

                communeStatsDiv.innerHTML = `
                    <div class="stat-item"><strong>Nom:</strong> ${commune.nom}</div>
                    <div class="stat-item"><strong>Code postal:</strong> ${commune.codesPostaux ? commune.codesPostaux.join(', ') : 'Non disponible'}</div>
                    <div class="stat-item"><strong>Population:</strong> ${commune.population ? commune.population : 'Non disponible'} habitants</div>
                    <div class="stat-item"><strong>Surface:</strong> ${commune.surface ? commune.surface + ' km²' : 'Non disponible'}</div>
                    <div class="stat-item"><strong>Code département:</strong> ${commune.codeDepartement}</div>
                    <div class="stat-item"><strong>Code région:</strong> ${commune.codeRegion}</div>
                `;
            } catch (error) {
                afficherErreur(`Erreur lors du chargement des statistiques de la commune: ${error.message}`);
            }
        }

        // Écouteurs d'événements
        regionSelect.addEventListener('change', (event) => {
            const codeRegion = event.target.value;
            chargerDepartements(codeRegion);
            viderCommunes();
            effacerErreur();
        });

        departementSelect.addEventListener('change', (event) => {
            const codeDepartement = event.target.value;
            chargerCommunes(codeDepartement);
            effacerErreur();
        });

        communeSelect.addEventListener('change', (event) => {
            const codeCommune = event.target.value;
            afficherStatistiquesCommune(codeCommune);
            effacerErreur();
        });

        // Initialisation
        chargerRegions();
    </script>
</body>
</html>
